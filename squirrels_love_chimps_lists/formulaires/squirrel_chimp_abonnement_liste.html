[(#REM)Récuperation des données]
#SET{listes,#CONFIG{squirrel_chimp/apiKey}|recuperer_listes{#ENV{filters}}}

[(#GET{listes}|table_valeur{error}|?{
	[<p class="reponse_formulaire_erreur">(#GET{listes}|table_valeur{error})</p>]
	,
	#SET{liste_donnes,#GET{listes}|table_valeur{data}}
	}
	)]

<div class="formulaire_spip formulaire_#FORM">
	<h2><:scl:abonnement_mailinglists:></h2>
	<form method="post" action="#ENV{action}"><div>
		#ACTION_FORMULAIRE{#ENV{action}}
		
	<BOUCLE_editer(CONDITION){si #ENV*{message_ok}|non}>
		<fieldset>
			<legend><:scl:donnees_personnelles:></legend>		
			<ul>
				
				[(#REM)récupère les champs accordées avec mailchimp]
				<BOUCLE_donnees_perso(POUR){tableau #ENV{donnees_personnelles}}>
					
				[<li class="zditer_#VALEUR[ (#ENV**{erreurs}|table_valeur{#VALEUR}|oui)erreur]">
					<label for="#VALEUR">#EVAL{_T('scl:#CLE');}</label>
					[
					<span class='erreur'>(#ENV**{erreurs}|table_valeur{#VALEUR})</span>
					]
					<input type="text" class="#VALEUR" name="(#VALEUR)" id="#VALEUR" value="#ENV{#VALEUR}"/>
				</li>]					
				
				</BOUCLE_donnees_perso>	
				
				<li class="editer_email[ (#ENV**{erreurs}|table_valeur{email}|oui)erreur]">
					<label for="email"><:scl:email:></label>				
					[
					<span class='erreur'>(#ENV**{erreurs}|table_valeur{email})</span>
					]
					<input type="text" class="email" name="email" id="email" value="#ENV{email}"/>

				</li>				
				<li class="editer_email2[ (#ENV**{erreurs}|table_valeur{email2}|oui)erreur]">
					<label for="email2"><:scl:email_confirmer:></label>				
					[
					<span class='erreur'>(#ENV**{erreurs}|table_valeur{email2})</span>
					]
					<input type="text" class="email2" name="email2" id="email2" value="#ENV{email2}"/>

				</li>				
				
			</ul>

		</fieldset>	
		<fieldset>
			<legend><:scl:mailinglists:></legend>
			<label for="ml_act_ajout"><:scl:choix_mailinglists_abonnement:></label>
				[
					<span class='erreur'>(#ENV**{erreurs}|table_valeur{mailinglists})</span>
					]			
			<ul>
			<BOUCLE_listes(POUR){tableau #GET{liste_donnes}}>	
			<li><div class="choix">
					<input type="checkbox" class="checkbox" name="mailinglists[]" id="mailinglists_[(#VALEUR|table_valeur{id})]" value="[(#VALEUR|table_valeur{id})]"[ (#VALEUR|table_valeur{id}|in_array{#ENV{mailinglists,#ARRAY{}}})oui) checked="checked"]/>
					<label for="ml_act_ajout">[(#VALEUR|table_valeur{name})]</label>
				</div>
			</li>
			</BOUCLE_listes>
			</ul>
		</fieldset>		
		<p class="boutons">
			<input type="submit" name="enregistrer" class="submit" value="<:bouton_valider:>" />
		</p>
	</BOUCLE_editer>		
	</div></form>
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
</div>
